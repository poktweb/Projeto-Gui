–∏–º–ø–æ—Ä—Ç * –∫–∞–∫ HTTP –∏–∑–º–æ–¥—É–ª—è "std/http"
–∏–º–ø–æ—Ä—Ç * –∫–∞–∫ FileSystem –∏–∑–º–æ–¥—É–ª—è "std/filesystem"
–∏–º–ø–æ—Ä—Ç * –∫–∞–∫ JSON –∏–∑–º–æ–¥—É–ª—è "std/json"
–∏–º–ø–æ—Ä—Ç * –∫–∞–∫ Date –∏–∑–º–æ–¥—É–ª—è "std/date"
–∏–º–ø–æ—Ä—Ç * –∫–∞–∫ Crypto –∏–∑–º–æ–¥—É–ª—è "std/crypto"
–∏–º–ø–æ—Ä—Ç * –∫–∞–∫ String –∏–∑–º–æ–¥—É–ª—è "std/string"
–∏–º–ø–æ—Ä—Ç * –∫–∞–∫ Array –∏–∑–º–æ–¥—É–ª—è "std/array"
–∏–º–ø–æ—Ä—Ç * –∫–∞–∫ DB –∏–∑–º–æ–¥—É–ª—è "std/database"
–∏–º–ø–æ—Ä—Ç * –∫–∞–∫ Style –∏–∑–º–æ–¥—É–ª—è "std/style"

# Armazenamento de sess√µes ativas (simples, em mem√≥ria)
–ø—É—Å—Ç—å sessions = {}

# Conex√£o com banco de dados (global)
–ø—É—Å—Ç—å db = –Ω—É–ª—å

# Fun√ß√£o para inicializar banco de dados
—Ñ—É–Ω–∫—Ü–∏—è inicializarBanco() {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        # Abrir conex√£o com banco de dados PostgreSQL (Neon)
        db = DB.–æ—Ç–∫—Ä—ã—Ç—å–ë–î("postgresql://neondb_owner:npg_pd1HbyWIz2Le@ep-shy-king-ahkd8twj-pooler.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require")
        
        # Criar tabelas se n√£o existirem (sintaxe PostgreSQL)
        db.execute("CREATE TABLE IF NOT EXISTS users (
            id SERIAL PRIMARY KEY,
            username VARCHAR(255) NOT NULL UNIQUE,
            password VARCHAR(255) NOT NULL
        )")
        
        db.execute("CREATE TABLE IF NOT EXISTS comments (
            id VARCHAR(255) PRIMARY KEY,
            name VARCHAR(255) NOT NULL,
            text TEXT NOT NULL,
            date BIGINT NOT NULL
        )")
        
        db.execute("CREATE TABLE IF NOT EXISTS whatsapp_numbers (
            id SERIAL PRIMARY KEY,
            name VARCHAR(255) NOT NULL,
            number VARCHAR(255) NOT NULL,
            active INTEGER DEFAULT 0,
            rotation_enabled INTEGER DEFAULT 0,
            click_limit INTEGER DEFAULT 0,
            current_clicks INTEGER DEFAULT 0
        )")
        
        # Adicionar novos campos se a tabela j√° existir (migra√ß√£o)
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
            db.execute("ALTER TABLE whatsapp_numbers ADD COLUMN rotation_enabled INTEGER DEFAULT 0")
        } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (e) {
            # Coluna j√° existe, ignorar
        }
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
            db.execute("ALTER TABLE whatsapp_numbers ADD COLUMN click_limit INTEGER DEFAULT 0")
        } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (e) {
            # Coluna j√° existe, ignorar
        }
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
            db.execute("ALTER TABLE whatsapp_numbers ADD COLUMN current_clicks INTEGER DEFAULT 0")
        } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (e) {
            # Coluna j√° existe, ignorar
        }
        
        db.execute("CREATE TABLE IF NOT EXISTS whatsapp_clicks (
            id SERIAL PRIMARY KEY,
            number_id INTEGER NOT NULL,
            click_date BIGINT NOT NULL,
            FOREIGN KEY (number_id) REFERENCES whatsapp_numbers(id)
        )")
        
        # Inserir usu√°rio inicial se n√£o existir
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
            –ø—É—Å—Ç—å usuarios = db.query("SELECT * FROM users WHERE username = ?", ["poktweb"])
            –µ—Å–ª–∏ (Array.–¥–ª–∏–Ω–∞(usuarios) == 0) {
                db.execute("INSERT INTO users (username, password) VALUES (?, ?)", ["poktweb", "84005787"])
                –ø–µ—á–∞—Ç—å("‚úÖ Usu√°rio inicial 'poktweb' criado")
            }
        } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (e) {
            –ø–µ—á–∞—Ç—å("‚ö†Ô∏è Erro ao criar usu√°rio inicial: " + e)
        }
        
        –ø–µ—á–∞—Ç—å("‚úÖ Banco de dados PostgreSQL inicializado")
        –≤–µ—Ä–Ω—É—Ç—å –∏—Å—Ç–∏–Ω–∞
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("‚ùå Erro ao inicializar banco de dados: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
}

# Inicializar banco ao iniciar
inicializarBanco()

# Fun√ß√£o para obter usu√°rios do banco de dados
—Ñ—É–Ω–∫—Ü–∏—è obterUsuarios() {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –ø–µ—á–∞—Ç—å("‚ö†Ô∏è Banco de dados n√£o inicializado")
            –≤–µ—Ä–Ω—É—Ç—å []
        }
        –ø—É—Å—Ç—å usuarios = db.query("SELECT * FROM users")
        –≤–µ—Ä–Ω—É—Ç—å usuarios
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao obter usu√°rios: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å []
    }
}

# Fun√ß√£o para verificar credenciais de usu√°rio
—Ñ—É–Ω–∫—Ü–∏—è verificarUsuario(username, password) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –ø–µ—á–∞—Ç—å("‚ö†Ô∏è Banco de dados n√£o inicializado")
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        –ø—É—Å—Ç—å usuarios = db.query("SELECT * FROM users WHERE username = ? AND password = ?", 
            [username, password])
        –µ—Å–ª–∏ (Array.–¥–ª–∏–Ω–∞(usuarios) > 0) {
            –≤–µ—Ä–Ω—É—Ç—å –∏—Å—Ç–∏–Ω–∞
        }
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao verificar usu√°rio: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
}

# Fun√ß√£o para obter coment√°rios do banco de dados
—Ñ—É–Ω–∫—Ü–∏—è obterComentarios() {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –ø–µ—á–∞—Ç—å("‚ö†Ô∏è Banco de dados n√£o inicializado")
            –≤–µ—Ä–Ω—É—Ç—å []
        }
        –ø—É—Å—Ç—å comentarios = db.query("SELECT * FROM comments ORDER BY date DESC")
        –≤–µ—Ä–Ω—É—Ç—å comentarios
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao obter coment√°rios: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å []
    }
}

# Fun√ß√£o para adicionar coment√°rio no banco de dados
—Ñ—É–Ω–∫—Ü–∏—è adicionarComentario(id, name, text, date) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –ø–µ—á–∞—Ç—å("‚ö†Ô∏è Banco de dados n√£o inicializado")
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        db.execute("INSERT INTO comments (id, name, text, date) VALUES (?, ?, ?, ?)", 
            [id, name, text, date])
        –≤–µ—Ä–Ω—É—Ç—å –∏—Å—Ç–∏–Ω–∞
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao adicionar coment√°rio: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
}

# Fun√ß√£o para atualizar coment√°rio no banco de dados
—Ñ—É–Ω–∫—Ü–∏—è atualizarComentario(id, text) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –ø–µ—á–∞—Ç—å("‚ö†Ô∏è Banco de dados n√£o inicializado")
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        –ø—É—Å—Ç—å resultado = db.execute("UPDATE comments SET text = ? WHERE id = ?", [text, id])
        –≤–µ—Ä–Ω—É—Ç—å resultado.changes > 0
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao atualizar coment√°rio: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
}

# Fun√ß√£o para deletar coment√°rio do banco de dados
—Ñ—É–Ω–∫—Ü–∏—è deletarComentario(id) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –ø–µ—á–∞—Ç—å("‚ö†Ô∏è Banco de dados n√£o inicializado")
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        –ø—É—Å—Ç—å resultado = db.execute("DELETE FROM comments WHERE id = ?", [id])
        –≤–µ—Ä–Ω—É—Ç—å resultado.changes > 0
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao deletar coment√°rio: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
}

# ========== FUN√á√ïES WHATSAPP ==========

# Fun√ß√£o para obter n√∫mero ativo do WhatsApp
—Ñ—É–Ω–∫—Ü–∏—è obterNumeroAtivo() {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –≤–µ—Ä–Ω—É—Ç—å –Ω—É–ª—å
        }
        –ø—É—Å—Ç—å numeros = db.query("SELECT * FROM whatsapp_numbers WHERE active = 1 LIMIT 1")
        –µ—Å–ª–∏ (Array.–¥–ª–∏–Ω–∞(numeros) > 0) {
            –≤–µ—Ä–Ω—É—Ç—å numeros[0]
        }
        –≤–µ—Ä–Ω—É—Ç—å –Ω—É–ª—å
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao obter n√∫mero ativo: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –Ω—É–ª—å
    }
}

# Fun√ß√£o para obter todos os n√∫meros do WhatsApp
—Ñ—É–Ω–∫—Ü–∏—è obterTodosNumeros() {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –≤–µ—Ä–Ω—É—Ç—å []
        }
        –ø—É—Å—Ç—å numeros = db.query("SELECT * FROM whatsapp_numbers ORDER BY active DESC, name ASC")
        –≤–µ—Ä–Ω—É—Ç—å numeros
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao obter n√∫meros: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å []
    }
}

# Fun√ß√£o para adicionar n√∫mero do WhatsApp
—Ñ—É–Ω–∫—Ü–∏—è adicionarNumero(name, number) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        db.execute("INSERT INTO whatsapp_numbers (name, number, active) VALUES (?, ?, 0)", 
            [name, number])
        –≤–µ—Ä–Ω—É—Ç—å –∏—Å—Ç–∏–Ω–∞
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao adicionar n√∫mero: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
}

# Fun√ß√£o para atualizar n√∫mero do WhatsApp
—Ñ—É–Ω–∫—Ü–∏—è atualizarNumero(id, name, number) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        –ø—É—Å—Ç—å resultado = db.execute("UPDATE whatsapp_numbers SET name = ?, number = ? WHERE id = ?", 
            [name, number, id])
        –≤–µ—Ä–Ω—É—Ç—å resultado.changes > 0
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao atualizar n√∫mero: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
}

# Fun√ß√£o para ativar n√∫mero (desativa todos os outros automaticamente)
—Ñ—É–Ω–∫—Ü–∏—è ativarNumero(id) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        # Desativar todos os n√∫meros
        db.execute("UPDATE whatsapp_numbers SET active = 0")
        # Ativar o n√∫mero selecionado e zerar contagem
        –ø—É—Å—Ç—å resultado = db.execute("UPDATE whatsapp_numbers SET active = 1, current_clicks = 0 WHERE id = ?", [id])
        –≤–µ—Ä–Ω—É—Ç—å resultado.changes > 0
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao ativar n√∫mero: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
}

# Fun√ß√£o para ativar/desativar rota√ß√£o autom√°tica
—Ñ—É–Ω–∫—Ü–∏—è definirRotacao(ativado, limite) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        # Atualizar todos os n√∫meros com as configura√ß√µes de rota√ß√£o
        db.execute("UPDATE whatsapp_numbers SET rotation_enabled = ?, click_limit = ?", 
            [ativado ? 1 : 0, limite])
        –≤–µ—Ä–Ω—É—Ç—å –∏—Å—Ç–∏–Ω–∞
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao definir rota√ß√£o: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
}

# Fun√ß√£o para obter configura√ß√£o de rota√ß√£o
—Ñ—É–Ω–∫—Ü–∏—è obterConfiguracaoRotacao() {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –≤–µ—Ä–Ω—É—Ç—å { enabled = –ª–æ–∂—å, limit = 0 }
        }
        –ø—É—Å—Ç—å config = db.query("SELECT rotation_enabled, click_limit FROM whatsapp_numbers LIMIT 1")
        –µ—Å–ª–∏ (Array.–¥–ª–∏–Ω–∞(config) > 0) {
            –≤–µ—Ä–Ω—É—Ç—å { 
                enabled = config[0].rotation_enabled == 1, 
                limit = config[0].click_limit 
            }
        }
        –≤–µ—Ä–Ω—É—Ç—å { enabled = –ª–æ–∂—å, limit = 0 }
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao obter configura√ß√£o de rota√ß√£o: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å { enabled = –ª–æ–∂—å, limit = 0 }
    }
}

# Fun√ß√£o para deletar n√∫mero do WhatsApp
—Ñ—É–Ω–∫—Ü–∏—è deletarNumero(id) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        # Deletar cliques associados
        db.execute("DELETE FROM whatsapp_clicks WHERE number_id = ?", [id])
        # Deletar n√∫mero
        –ø—É—Å—Ç—å resultado = db.execute("DELETE FROM whatsapp_numbers WHERE id = ?", [id])
        –≤–µ—Ä–Ω—É—Ç—å resultado.changes > 0
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao deletar n√∫mero: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
}

# Fun√ß√£o para rotacionar para o pr√≥ximo n√∫mero
—Ñ—É–Ω–∫—Ü–∏—è rotacionarProximoNumero() {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        
        # Obter n√∫mero ativo atual
        –ø—É—Å—Ç—å numeroAtual = obterNumeroAtivo()
        –µ—Å–ª–∏ (numeroAtual == –Ω—É–ª—å) {
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        
        # Zerar contagem do n√∫mero atual
        db.execute("UPDATE whatsapp_numbers SET current_clicks = 0, active = 0 WHERE id = ?", 
            [numeroAtual.id])
        
        # Obter todos os n√∫meros ordenados
        –ø—É—Å—Ç—å todosNumeros = db.query("SELECT * FROM whatsapp_numbers ORDER BY id ASC")
        –µ—Å–ª–∏ (Array.–¥–ª–∏–Ω–∞(todosNumeros) == 0) {
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        
        # Encontrar √≠ndice do n√∫mero atual
        –ø—É—Å—Ç—å indiceAtual = -1
        –¥–ª—è (–ø—É—Å—Ç—å i = 0; i < Array.–¥–ª–∏–Ω–∞(todosNumeros); i = i + 1) {
            –µ—Å–ª–∏ (todosNumeros[i].id == numeroAtual.id) {
                indiceAtual = i
                –ø—Ä–µ—Ä–≤–∞—Ç—å
            }
        }
        
        # Encontrar pr√≥ximo n√∫mero (circular)
        –ø—É—Å—Ç—å proximoIndice = (indiceAtual + 1) % Array.–¥–ª–∏–Ω–∞(todosNumeros)
        –ø—É—Å—Ç—å proximoNumero = todosNumeros[proximoIndice]
        
        # Ativar pr√≥ximo n√∫mero
        db.execute("UPDATE whatsapp_numbers SET active = 1, current_clicks = 0 WHERE id = ?", 
            [proximoNumero.id])
        
        –ø–µ—á–∞—Ç—å("üîÑ Rota√ß√£o: " + numeroAtual.name + " ‚Üí " + proximoNumero.name)
        –≤–µ—Ä–Ω—É—Ç—å –∏—Å—Ç–∏–Ω–∞
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao rotacionar n√∫mero: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
}

# Fun√ß√£o para verificar e aplicar rota√ß√£o se necess√°rio
—Ñ—É–Ω–∫—Ü–∏—è verificarERotacionar() {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        
        # Obter n√∫mero ativo com configura√ß√µes ATUALIZADAS (ap√≥s incremento)
        –ø—É—Å—Ç—å numeroAtivo = db.query("SELECT * FROM whatsapp_numbers WHERE active = 1 LIMIT 1")
        –µ—Å–ª–∏ (Array.–¥–ª–∏–Ω–∞(numeroAtivo) == 0) {
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        
        numeroAtivo = numeroAtivo[0]
        
        # Verificar se rota√ß√£o est√° ativada globalmente
        –µ—Å–ª–∏ (numeroAtivo.rotation_enabled != 1) {
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        
        # Verificar se atingiu o limite (ap√≥s incremento)
        –µ—Å–ª–∏ (numeroAtivo.click_limit > 0 && numeroAtivo.current_clicks >= numeroAtivo.click_limit) {
            –ø–µ—á–∞—Ç—å("üîÑ Limite atingido! " + numeroAtivo.name + " tem " + numeroAtivo.current_clicks + " cliques (limite: " + numeroAtivo.click_limit + ")")
            # Rotacionar para pr√≥ximo
            –≤–µ—Ä–Ω—É—Ç—å rotacionarProximoNumero()
        }
        
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao verificar rota√ß√£o: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
}

# Fun√ß√£o para registrar clique no WhatsApp
—Ñ—É–Ω–∫—Ü–∏—è registrarClique(numberId) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
        }
        
        # Obter n√∫mero ativo atual ANTES de incrementar
        –ø—É—Å—Ç—å numeroAtivo = obterNumeroAtivo()
        –µ—Å–ª–∏ (numeroAtivo == –Ω—É–ª—å || numeroAtivo.id != numberId) {
            # Se o n√∫mero n√£o est√° ativo, n√£o incrementa current_clicks
            # Apenas registra o clique hist√≥rico
            db.execute("INSERT INTO whatsapp_clicks (number_id, click_date) VALUES (?, ?)", 
                [numberId, Date.timestamp()])
            –≤–µ—Ä–Ω—É—Ç—å –∏—Å—Ç–∏–Ω–∞
        }
        
        # Registrar clique na tabela de hist√≥rico
        db.execute("INSERT INTO whatsapp_clicks (number_id, click_date) VALUES (?, ?)", 
            [numberId, Date.timestamp()])
        
        # Incrementar contador APENAS do n√∫mero ativo
        db.execute("UPDATE whatsapp_numbers SET current_clicks = current_clicks + 1 WHERE id = ? AND active = 1", 
            [numberId])
        
        # Verificar se precisa rotacionar (DEPOIS do incremento)
        verificarERotacionar()
        
        –≤–µ—Ä–Ω—É—Ç—å –∏—Å—Ç–∏–Ω–∞
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao registrar clique: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
}

# Fun√ß√£o para obter estat√≠sticas de cliques por n√∫mero
—Ñ—É–Ω–∫—Ü–∏—è obterEstatisticasCliques() {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –µ—Å–ª–∏ (db == –Ω—É–ª—å) {
            –≤–µ—Ä–Ω—É—Ç—å []
        }
        –ø—É—Å—Ç—å stats = db.query("SELECT 
            wn.id,
            wn.name,
            wn.number,
            wn.active,
            wn.rotation_enabled,
            wn.click_limit,
            wn.current_clicks,
            COUNT(wc.id) as total_clicks
        FROM whatsapp_numbers wn
        LEFT JOIN whatsapp_clicks wc ON wn.id = wc.number_id
        GROUP BY wn.id
        ORDER BY wn.active DESC, total_clicks DESC")
        –≤–µ—Ä–Ω—É—Ç—å stats
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao obter estat√≠sticas: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å []
    }
}

# Fun√ß√£o para extrair cookies do header
—Ñ—É–Ω–∫—Ü–∏—è extrairCookie(headerCookie, nome) {
    –µ—Å–ª–∏ (headerCookie == –Ω—É–ª—å || headerCookie == "") {
        –≤–µ—Ä–Ω—É—Ç—å –Ω—É–ª—å
    }
    –ø—É—Å—Ç—å cookies = String.—Ä–∞–∑–¥–µ–ª–∏—Ç—å(headerCookie, ";")
    –¥–ª—è (–ø—É—Å—Ç—å cookie –∏–∑ cookies) {
        –ø—É—Å—Ç—å partes = String.—Ä–∞–∑–¥–µ–ª–∏—Ç—å(String.–Ω–∏–∂–Ω–∏–π(cookie), "=")
        –µ—Å–ª–∏ (Array.–¥–ª–∏–Ω–∞(partes) == 2) {
            –ø—É—Å—Ç—å key = String.–∑–∞–º–µ–Ω–∏—Ç—å(partes[0], " ", "")
            –ø—É—Å—Ç—å value = String.–∑–∞–º–µ–Ω–∏—Ç—å(partes[1], " ", "")
            –µ—Å–ª–∏ (key == nome) {
                –≤–µ—Ä–Ω—É—Ç—å value
            }
        }
    }
    –≤–µ—Ä–Ω—É—Ç—å –Ω—É–ª—å
}

# Fun√ß√£o para verificar autentica√ß√£o
—Ñ—É–Ω–∫—Ü–∏—è verificarAuth(–∑–∞–ø—Ä–æ—Å) {
    –ø—É—Å—Ç—å cookieHeader = –∑–∞–ø—Ä–æ—Å.headers["cookie"]
    –µ—Å–ª–∏ (cookieHeader == –Ω—É–ª—å) {
        cookieHeader = –∑–∞–ø—Ä–æ—Å.headers["Cookie"]
    }
    –ø—É—Å—Ç—å token = extrairCookie(cookieHeader, "auth_token")
    –µ—Å–ª–∏ (token == –Ω—É–ª—å) {
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
    –µ—Å–ª–∏ (sessions[token] == –Ω—É–ª—å) {
        –≤–µ—Ä–Ω—É—Ç—å –ª–æ–∂—å
    }
    –≤–µ—Ä–Ω—É—Ç—å –∏—Å—Ç–∏–Ω–∞
}

# Fun√ß√£o para criar token de sess√£o
—Ñ—É–Ω–∫—Ü–∏—è criarToken() {
    –ø—É—Å—Ç—å timestamp = Date.timestamp()
    –ø—É—Å—Ç—å random = Crypto.randomBytes(16)
    –≤–µ—Ä–Ω—É—Ç—å Crypto.sha256(timestamp + random + "trest_admin")
}

# Fun√ß√£o para carregar CSS usando m√≥dulo Style do Trest
—Ñ—É–Ω–∫—Ü–∏—è carregarCSS() {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        # Tentar carregar CSS usando Style.loadFile (funciona em compila√ß√£o web)
        # No Node.js, usamos FileSystem para ler o arquivo
        –µ—Å–ª–∏ (FileSystem.exists("styles.css")) {
            –ø—É—Å—Ç—å cssContent = FileSystem.readFile("styles.css")
            –≤–µ—Ä–Ω—É—Ç—å "<style>\n" + cssContent + "\n</style>"
        } –∏–Ω–∞—á–µ {
            # Fallback: CSS inline b√°sico se arquivo n√£o existir
            –ø–µ—á–∞—Ç—å("‚ö†Ô∏è Arquivo styles.css n√£o encontrado, usando CSS inline")
            –≤–µ—Ä–Ω—É—Ç—å "<style>* { margin: 0; padding: 0; box-sizing: border-box; }</style>"
        }
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro ao carregar CSS: " + erro)
        –≤–µ—Ä–Ω—É—Ç—å "<style>* { margin: 0; padding: 0; box-sizing: border-box; }</style>"
    }
}

# Fun√ß√£o para gerar HTML da p√°gina de login
—Ñ—É–Ω–∫—Ü–∏—è obterHTMLLogin() {
    –≤–µ—Ä–Ω—É—Ç—å "<!DOCTYPE html>\n" +
"<html lang=\"pt-BR\">\n" +
"<head>\n" +
"    <meta charset=\"UTF-8\">\n" +
"    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n" +
"    <title>Login - Painel Admin</title>\n" +
carregarCSS() + "\n" +
"</head>\n" +
"<body>\n" +
"    <div class=\"login-container\">\n" +
"        <h1>üîê Login Admin</h1>\n" +
"        <form class=\"login-form\" id=\"loginForm\">\n" +
"            <input type=\"text\" id=\"username\" placeholder=\"Usu√°rio\" required autofocus>\n" +
"            <input type=\"password\" id=\"password\" placeholder=\"Senha\" required>\n" +
"            <button type=\"submit\">Entrar</button>\n" +
"            <div id=\"error\" class=\"error\" style=\"display: none;\"></div>\n" +
"        </form>\n" +
"        <a href=\"/\" class=\"link-back\">‚Üê Voltar ao site</a>\n" +
"    </div>\n" +
"    <script>\n" +
"        document.getElementById('loginForm').addEventListener('submit', function(e) {\n" +
"            e.preventDefault();\n" +
"            const username = document.getElementById('username').value;\n" +
"            const password = document.getElementById('password').value;\n" +
"\n" +
"            fetch('/api/login', {\n" +
"                method: 'POST',\n" +
"                headers: { 'Content-Type': 'application/json' },\n" +
"                body: JSON.stringify({ username: username, password: password })\n" +
"            })\n" +
"            .then(res => res.json())\n" +
"            .then(data => {\n" +
"                if (data.success) {\n" +
"                    window.location.href = '/admin';\n" +
"                } else {\n" +
"                    const errorDiv = document.getElementById('error');\n" +
"                    errorDiv.textContent = data.error || 'Credenciais inv√°lidas';\n" +
"                    errorDiv.style.display = 'block';\n" +
"                }\n" +
"            })\n" +
"            .catch(err => {\n" +
"                const errorDiv = document.getElementById('error');\n" +
"                errorDiv.textContent = 'Erro ao fazer login';\n" +
"                errorDiv.style.display = 'block';\n" +
"            });\n" +
"        });\n" +
"    </script>\n" +
"</body>\n" +
"</html>"
}

# Fun√ß√£o para gerar HTML completo do site
—Ñ—É–Ω–∫—Ü–∏—è obterHTMLCompleto() {
    –≤–µ—Ä–Ω—É—Ç—å "<!DOCTYPE html>\n" +
"<html lang=\"pt-BR\">\n" +
"<head>\n" +
"    <meta charset=\"UTF-8\">\n" +
"    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n" +
"    <title>Trest Language - Documenta√ß√£o</title>\n" +
carregarCSS() + "\n" +
"</head>\n" +
"<body>\n" +
"    <!-- Menu Lateral -->\n" +
"    <aside class=\"sidebar\">\n" +
"        <div class=\"sidebar-header\">\n" +
"            <h1>üöÄ Trest</h1>\n" +
"            <p>v2.4.9</p>\n" +
"        </div>\n" +
"        <nav>\n" +
"            <ul class=\"nav-menu\">\n" +
"                <li><a href=\"#inicio\">In√≠cio</a></li>\n" +
"                <li><a href=\"#sobre\">Sobre</a></li>\n" +
"                <li><a href=\"#pontos-fortes\">Pontos Fortes</a></li>\n" +
"                <li><a href=\"#caracteristicas\">Caracter√≠sticas</a></li>\n" +
"                <li><a href=\"#exemplos\">Exemplos</a></li>\n" +
"                <li><a href=\"#biblioteca\">Biblioteca Padr√£o</a></li>\n" +
"                <li><a href=\"#links\">Links √öteis</a></li>\n" +
"                <li><a href=\"#whatsapp\">WhatsApp</a></li>\n" +
"                <li><a href=\"#comentarios\">Coment√°rios</a></li>\n" +
"            </ul>\n" +
"        </nav>\n" +
"    </aside>\n" +
"\n" +
"    <!-- Conte√∫do Principal -->\n" +
"    <main class=\"main-content\">\n" +
"        <section id=\"inicio\">\n" +
"            <h1>Trest Language</h1>\n" +
"            <p class=\"intro\">\n" +
"                Linguagem de programa√ß√£o moderna e profissional com suporte completo a cir√≠lico.\n" +
"                Permite programar usando palavras-chave em russo ou latino, mantendo a mesma sintaxe e funcionalidades.\n" +
"            </p>\n" +
"            <p>\n" +
"                Trest compila para Web (JavaScript) e Desktop (.exe), oferecendo uma biblioteca padr√£o rica\n" +
"                e um sistema de m√≥dulos completo. Zero barreira lingu√≠stica para falantes de russo.\n" +
"            </p>\n" +
"        </section>\n" +
"\n" +
"        <section id=\"sobre\">\n" +
"            <h2>Sobre Trest</h2>\n" +
"            <p>\n" +
"                Trest √© uma linguagem de programa√ß√£o criada para ser moderna, intuitiva e poderosa.\n" +
"                Sua principal caracter√≠stica √© o suporte nativo ao alfabeto cir√≠lico, permitindo que\n" +
"                programadores russos escrevam c√≥digo usando palavras-chave em seu idioma nativo.\n" +
"            </p>\n" +
"            <p>\n" +
"                Desenvolvida com foco em produtividade, Trest oferece uma sintaxe limpa baseada em\n" +
"                JavaScript/TypeScript, mas com recursos √∫nicos que a tornam especial. O mesmo c√≥digo\n" +
"                pode ser compilado para diferentes plataformas sem modifica√ß√µes.\n" +
"            </p>\n" +
"            <div class=\"code-block\">\n" +
"                <code>–ø–µ—á–∞—Ç—å(\"–ü—Ä–∏–≤–µ—Ç, –ú–∏—Ä!\")</code>\n" +
"            </div>\n" +
"        </section>\n" +
"\n" +
"        <section id=\"pontos-fortes\">\n" +
"            <h2>Pontos Fortes</h2>\n" +
"            <div class=\"feature-grid\">\n" +
"                <div class=\"feature-card\">\n" +
"                    <h3>üåê Suporte Total ao Cir√≠lico</h3>\n" +
"                    <p>Palavras-chave em russo nativas, permitindo programa√ß√£o completamente em cir√≠lico.</p>\n" +
"                </div>\n" +
"                <div class=\"feature-card\">\n" +
"                    <h3>‚ö° Compila√ß√£o Universal</h3>\n" +
"                    <p>Compila para Web (JavaScript) e Desktop (.exe) a partir do mesmo c√≥digo fonte.</p>\n" +
"                </div>\n" +
"                <div class=\"feature-card\">\n" +
"                    <h3>üìö Biblioteca Padr√£o Rica</h3>\n" +
"                    <p>15+ m√≥dulos prontos para usar: HTTP, Crypto, FileSystem, Database e mais.</p>\n" +
"                </div>\n" +
"                <div class=\"feature-card\">\n" +
"                    <h3>üîß Tipagem Din√¢mica</h3>\n" +
"                    <p>Tipos inferidos automaticamente, tornando o desenvolvimento mais √°gil.</p>\n" +
"                </div>\n" +
"                <div class=\"feature-card\">\n" +
"                    <h3>üì¶ Sistema de M√≥dulos</h3>\n" +
"                    <p>Import/Export completo para organizar c√≥digo em m√∫ltiplos arquivos.</p>\n" +
"                </div>\n" +
"                <div class=\"feature-card\">\n" +
"                    <h3>üõ°Ô∏è Tratamento de Erros</h3>\n" +
"                    <p>Try/Catch/Throw robusto com mensagens claras de erro.</p>\n" +
"                </div>\n" +
"            </div>\n" +
"        </section>\n" +
"\n" +
"        <section id=\"caracteristicas\">\n" +
"            <h2>Caracter√≠sticas Principais</h2>\n" +
"            <ul>\n" +
"                <li><strong>Execu√ß√£o Inline:</strong> Execute c√≥digo direto na linha de comando com <code>-e</code></li>\n" +
"                <li><strong>Compila√ß√£o para Web:</strong> Gera JavaScript otimizado para navegadores e Node.js</li>\n" +
"                <li><strong>Compila√ß√£o para Desktop:</strong> Cria execut√°veis .exe nativos standalone</li>\n" +
"                <li><strong>Sintaxe Intuitiva:</strong> Baseada em JavaScript/TypeScript, f√°cil de aprender</li>\n" +
"                <li><strong>Zero Configura√ß√£o:</strong> Funciona imediatamente ap√≥s instala√ß√£o</li>\n" +
"                <li><strong>Desenvolvimento Ativo:</strong> Vers√£o 2.4.9 com melhorias constantes</li>\n" +
"            </ul>\n" +
"        </section>\n" +
"\n" +
"        <section id=\"exemplos\">\n" +
"            <h2>Exemplos de C√≥digo</h2>\n" +
"\n" +
"            <h3>Vari√°veis e Fun√ß√µes</h3>\n" +
"            <div class=\"code-block\">\n" +
"                <code>–ø—É—Å—Ç—å –∏–º—è = \"Trest\"<br>" +
"–ø—É—Å—Ç—å –≤–æ–∑—Ä–∞—Å—Ç = 25<br><br>" +
"—Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ(–∏–º—è) {<br>" +
"&nbsp;&nbsp;&nbsp;&nbsp;–≤–µ—Ä–Ω—É—Ç—å \"–ü—Ä–∏–≤–µ—Ç, \" + –∏–º—è<br>" +
"}<br><br>" +
"–ø–µ—á–∞—Ç—å(–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ(\"–ú–∏—Ä\"))</code>\n" +
"            </div>\n" +
"\n" +
"            <h3>Condicionais e Loops</h3>\n" +
"            <div class=\"code-block\">\n" +
"                <code>–µ—Å–ª–∏ (–≤–æ–∑—Ä–∞—Å—Ç >= 18) {<br>" +
"&nbsp;&nbsp;&nbsp;&nbsp;–ø–µ—á–∞—Ç—å(\"–°–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–ª–µ—Ç–Ω–∏–π\")<br>" +
"} –∏–Ω–∞—á–µ {<br>" +
"&nbsp;&nbsp;&nbsp;&nbsp;–ø–µ—á–∞—Ç—å(\"–†–µ–±–µ–Ω–æ–∫\")<br>" +
"}<br><br>" +
"–¥–ª—è (–ø—É—Å—Ç—å i = 0; i < 10; i = i + 1) {<br>" +
"&nbsp;&nbsp;&nbsp;&nbsp;–ø–µ—á–∞—Ç—å(i)<br>" +
"}</code>\n" +
"            </div>\n" +
"\n" +
"            <h3>Servidor HTTP</h3>\n" +
"            <div class=\"code-block\">\n" +
"                <code>–∏–º–ø–æ—Ä—Ç * –∫–∞–∫ HTTP –∏–∑–º–æ–¥—É–ª—è \"std/http\"<br><br>" +
"–ø—É—Å—Ç—å servidor = HTTP.—Å–æ–∑–¥–∞—Ç—å–°–µ—Ä–≤–µ—Ä()<br><br>" +
"servidor.get(\"/\", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {<br>" +
"&nbsp;&nbsp;&nbsp;&nbsp;–æ—Ç–≤–µ—Ç.send(\"<h1>Ol√° do Trest!</h1>\")<br>" +
"})<br><br>" +
"servidor.listen(3000, —Ñ—É–Ω–∫—Ü–∏—è() {<br>" +
"&nbsp;&nbsp;&nbsp;&nbsp;–ø–µ—á–∞—Ç—å(\"‚úÖ Servidor iniciado\")<br>" +
"})</code>\n" +
"            </div>\n" +
"\n" +
"            <h3>Classes e OOP</h3>\n" +
"            <div class=\"code-block\">\n" +
"                <code>–∫–ª–∞—Å—Å –ß–µ–ª–æ–≤–µ–∫ {<br>" +
"&nbsp;&nbsp;&nbsp;&nbsp;—Ñ—É–Ω–∫—Ü–∏—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä(–∏–º—è, –≤–æ–∑—Ä–∞—Å—Ç) {<br>" +
"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;—ç—Ç–æ.–∏–º—è = –∏–º—è<br>" +
"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;—ç—Ç–æ.–≤–æ–∑—Ä–∞—Å—Ç = –≤–æ–∑—Ä–∞—Å—Ç<br>" +
"&nbsp;&nbsp;&nbsp;&nbsp;}<br>" +
"}<br><br>" +
"–ø—É—Å—Ç—å –∏–≤–∞–Ω = –Ω–æ–≤—ã–π –ß–µ–ª–æ–≤–µ–∫(\"–ò–≤–∞–Ω\", 30)<br>" +
"–ø–µ—á–∞—Ç—å(–∏–≤–∞–Ω.–∏–º—è)</code>\n" +
"            </div>\n" +
"        </section>\n" +
"\n" +
"        <section id=\"biblioteca\">\n" +
"            <h2>Biblioteca Padr√£o (std)</h2>\n" +
"            <p>Trest inclui uma biblioteca padr√£o completa com 15 m√≥dulos prontos para usar:</p>\n" +
"            <ul>\n" +
"                <li><strong>Math:</strong> Fun√ß√µes matem√°ticas (sqrt, pow, abs, PI, E)</li>\n" +
"                <li><strong>String:</strong> Manipula√ß√£o de strings (tamanho, mai√∫sculas, substituir)</li>\n" +
"                <li><strong>Array:</strong> Opera√ß√µes com arrays (adicionar, remover, ordenar)</li>\n" +
"                <li><strong>HTTP:</strong> Cliente e servidor HTTP completo</li>\n" +
"                <li><strong>Crypto:</strong> Criptografia e seguran√ßa (MD5, SHA256, AES)</li>\n" +
"                <li><strong>FileSystem:</strong> Opera√ß√µes de arquivo e diret√≥rio</li>\n" +
"                <li><strong>JSON:</strong> Parsing e stringifica√ß√£o de JSON</li>\n" +
"                <li><strong>Date:</strong> Manipula√ß√£o de datas e timestamps</li>\n" +
"                <li><strong>Database:</strong> Conex√£o e modelos de banco de dados</li>\n" +
"                <li><strong>Async:</strong> Promises, timers e opera√ß√µes ass√≠ncronas</li>\n" +
"                <li><strong>RegEx:</strong> Express√µes regulares</li>\n" +
"                <li><strong>Path:</strong> Manipula√ß√£o de caminhos de arquivo</li>\n" +
"                <li><strong>Process:</strong> Vari√°veis de ambiente e sistema</li>\n" +
"                <li><strong>IO:</strong> Entrada e sa√≠da de dados</li>\n" +
"                <li><strong>GUI:</strong> Interface gr√°fica (em desenvolvimento)</li>\n" +
"            </ul>\n" +
"        </section>\n" +
"\n" +
"        <section id=\"whatsapp\">\n" +
"            <h2>Fale Conosco</h2>\n" +
"            <p>Entre em contato conosco pelo WhatsApp:</p>\n" +
"            <a href=\"#\" id=\"whatsappBtn\" class=\"whatsapp-button\" target=\"_blank\" onclick=\"handleWhatsAppClick(event)\">\n" +
"                <span class=\"whatsapp-icon\">üí¨</span>\n" +
"                <span>Conversar no WhatsApp</span>\n" +
"            </a>\n" +
"        </section>\n" +
"\n" +
"        <section id=\"comentarios\">\n" +
"            <h2>Coment√°rios</h2>\n" +
"            <div class=\"comment-form\">\n" +
"                <h3>Deixe seu coment√°rio</h3>\n" +
"                <form id=\"commentForm\">\n" +
"                    <input type=\"text\" id=\"commentName\" placeholder=\"Seu nome\" required>\n" +
"                    <textarea id=\"commentText\" placeholder=\"Seu coment√°rio\" rows=\"4\" required></textarea>\n" +
"                    <button type=\"submit\">Enviar Coment√°rio</button>\n" +
"                </form>\n" +
"            </div>\n" +
"            <div id=\"commentsList\" class=\"comments-list\">\n" +
"                <p style=\"color: var(--text-secondary);\">Carregando coment√°rios...</p>\n" +
"            </div>\n" +
"        </section>\n" +
"\n" +
"        <section id=\"links\">\n" +
"            <h2>Links √öteis</h2>\n" +
"            <div class=\"links-grid\">\n" +
"                <a href=\"https://trest-site.vercel.app/\" target=\"_blank\" class=\"link-card\">\n" +
"                    <h4>üåê Site Oficial</h4>\n" +
"                    <p>Documenta√ß√£o completa e exemplos no site oficial do Trest</p>\n" +
"                </a>\n" +
"                <a href=\"https://www.npmjs.com/package/treste\" target=\"_blank\" class=\"link-card\">\n" +
"                    <h4>üì¶ NPM Package</h4>\n" +
"                    <p>Pacote oficial no NPM para instala√ß√£o e uso</p>\n" +
"                </a>\n" +
"                <a href=\"https://socket.dev/npm/package/treste\" target=\"_blank\" class=\"link-card\">\n" +
"                    <h4>üîí Socket Security</h4>\n" +
"                    <p>An√°lise de seguran√ßa do pacote Trest no Socket</p>\n" +
"                </a>\n" +
"            </div>\n" +
"            <p style=\"margin-top: 2rem; color: var(--text-secondary); font-size: 0.875rem;\">\n" +
"                Vers√£o 2.4.9 ‚Ä¢ Licen√ßa MIT ‚Ä¢ Desenvolvido por PoktWeb\n" +
"            </p>\n" +
"        </section>\n" +
"    </main>\n" +
"    <script>\n" +
"        // Carregar coment√°rios ao carregar p√°gina\n" +
"        function carregarComentarios() {\n" +
"            fetch('/api/comments')\n" +
"                .then(res => res.json())\n" +
"                .then(data => {\n" +
"                    const listDiv = document.getElementById('commentsList');\n" +
"                    if (data.length === 0) {\n" +
"                        listDiv.innerHTML = '<p style=\"color: var(--text-secondary);\">Nenhum coment√°rio ainda. Seja o primeiro!</p>';\n" +
"                        return;\n" +
"                    }\n" +
"                    listDiv.innerHTML = data.map(comment => `\n" +
"                        <div class=\"comment-item\">\n" +
"                            <div class=\"comment-header\">\n" +
"                                <span class=\"comment-author\">${escapeHtml(comment.name)}</span>\n" +
"                                <span class=\"comment-date\">${new Date(comment.date).toLocaleString('pt-BR')}</span>\n" +
"                            </div>\n" +
"                            <div class=\"comment-text\">${escapeHtml(comment.text)}</div>\n" +
"                        </div>\n" +
"                    `).join('');\n" +
"                })\n" +
"                .catch(err => {\n" +
"                    console.error('Erro ao carregar coment√°rios:', err);\n" +
"                    document.getElementById('commentsList').innerHTML = '<p style=\"color: var(--text-secondary);\">Erro ao carregar coment√°rios.</p>';\n" +
"                });\n" +
"        }\n" +
"\n" +
"        function escapeHtml(text) {\n" +
"            const div = document.createElement('div');\n" +
"            div.textContent = text;\n" +
"            return div.innerHTML;\n" +
"        }\n" +
"\n" +
"        // Enviar coment√°rio\n" +
"        document.getElementById('commentForm').addEventListener('submit', function(e) {\n" +
"            e.preventDefault();\n" +
"            const name = document.getElementById('commentName').value;\n" +
"            const text = document.getElementById('commentText').value;\n" +
"\n" +
"            fetch('/api/comments', {\n" +
"                method: 'POST',\n" +
"                headers: { 'Content-Type': 'application/json' },\n" +
"                body: JSON.stringify({ name: name, text: text })\n" +
"            })\n" +
"            .then(res => res.json())\n" +
"            .then(data => {\n" +
"                if (data.success) {\n" +
"                    document.getElementById('commentForm').reset();\n" +
"                    carregarComentarios();\n" +
"                } else {\n" +
"                    alert('Erro ao enviar coment√°rio: ' + (data.error || 'Erro desconhecido'));\n" +
"                }\n" +
"            })\n" +
"            .catch(err => {\n" +
"                console.error('Erro:', err);\n" +
"                alert('Erro ao enviar coment√°rio');\n" +
"            });\n" +
"        });\n" +
"\n" +
"        // Carregar coment√°rios ao carregar p√°gina\n" +
"        carregarComentarios();\n" +
"\n" +
"        // Carregar n√∫mero ativo do WhatsApp (com cache-busting)\n" +
"        function carregarWhatsApp() {\n" +
"            // Adicionar timestamp para evitar cache do navegador\n" +
"            const timestamp = new Date().getTime();\n" +
"            fetch('/api/whatsapp/active?t=' + timestamp, {\n" +
"                method: 'GET',\n" +
"                cache: 'no-cache',\n" +
"                headers: {\n" +
"                    'Cache-Control': 'no-cache, no-store, must-revalidate',\n" +
"                    'Pragma': 'no-cache'\n" +
"                }\n" +
"            })\n" +
"                .then(res => res.json())\n" +
"                .then(data => {\n" +
"                    const btn = document.getElementById('whatsappBtn');\n" +
"                    if (data.number) {\n" +
"                        // Remover caracteres n√£o num√©ricos e criar URL do WhatsApp\n" +
"                        const numeroLimpo = data.number.replace(/[^0-9]/g, '');\n" +
"                        const mensagem = encodeURIComponent('Ol√°! Gostaria de saber mais sobre o Trest.');\n" +
"                        const whatsappUrl = 'https://wa.me/' + numeroLimpo + '?text=' + mensagem;\n" +
"                        btn.href = whatsappUrl;\n" +
"                        btn.target = '_blank';\n" +
"                        btn.style.display = 'inline-flex';\n" +
"                    } else {\n" +
"                        btn.style.display = 'none';\n" +
"                    }\n" +
"                })\n" +
"                .catch(err => {\n" +
"                    console.error('Erro ao carregar WhatsApp:', err);\n" +
"                    document.getElementById('whatsappBtn').style.display = 'none';\n" +
"                });\n" +
"        }\n" +
"\n" +
"        // Recarregar n√∫mero do WhatsApp a cada 30 segundos para pegar atualiza√ß√µes\n" +
"        setInterval(carregarWhatsApp, 30000);\n" +
"\n" +
"        // Registrar clique no WhatsApp\n" +
"        function handleWhatsAppClick(event) {\n" +
"            // Registrar clique sem bloquear o redirecionamento\n" +
"            fetch('/api/whatsapp/click', { method: 'POST' })\n" +
"                .catch(err => console.error('Erro ao registrar clique:', err));\n" +
"            // Permitir que o link funcione normalmente (n√£o usar preventDefault)\n" +
"        }\n" +
"\n" +
"        carregarWhatsApp();\n" +
"    </script>\n" +
"</body>\n" +
"</html>"
}

# Criar servidor HTTP
–ø—É—Å—Ç—å servidor = HTTP.—Å–æ–∑–¥–∞—Ç—å–°–µ—Ä–≤–µ—Ä()

# Rota principal
servidor.get("/", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –æ—Ç–≤–µ—Ç.status(200)
    –æ—Ç–≤–µ—Ç.header("Content-Type", "text/html; charset=utf-8")
    –æ—Ç–≤–µ—Ç.send(obterHTMLCompleto())
})

# Rota de status (API JSON)
servidor.get("/api/status", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –ø—É—Å—Ç—å status = {
        servidor = "Trest",
        versao = "2.4.9",
        online = –∏—Å—Ç–∏–Ω–∞,
        linguagem = "Trest Language"
    }
    –æ—Ç–≤–µ—Ç.json(status)
})

# Rota de login (p√°gina)
servidor.get("/login", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –æ—Ç–≤–µ—Ç.status(200)
    –æ—Ç–≤–µ—Ç.header("Content-Type", "text/html; charset=utf-8")
    –æ—Ç–≤–µ—Ç.send(obterHTMLLogin())
})

# API de login
servidor.post("/api/login", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –ø—É—Å—Ç—å body = –∑–∞–ø—Ä–æ—Å.body
        –ø–µ—á–∞—Ç—å("Login attempt - body: " + body)
        –ø—É—Å—Ç—å username = body.username
        –ø—É—Å—Ç—å password = body.password
        –ø–µ—á–∞—Ç—å("Login attempt - username: " + username + ", password: " + password)
        
        # Verificar credenciais no banco de dados
        –ø–µ—á–∞—Ç—å("Verificando credenciais para: " + username)
        –ø—É—Å—Ç—å userEncontrado = verificarUsuario(username, password)
        
        –µ—Å–ª–∏ (userEncontrado) {
            –ø—É—Å—Ç—å token = criarToken()
            sessions[token] = { username = username, timestamp = Date.timestamp() }
            –æ—Ç–≤–µ—Ç.header("Set-Cookie", "auth_token=" + token + "; Path=/; HttpOnly; Max-Age=3600")
            –æ—Ç–≤–µ—Ç.json({ success = –∏—Å—Ç–∏–Ω–∞, token = token })
        } –∏–Ω–∞—á–µ {
            –æ—Ç–≤–µ—Ç.status(401)
            –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Credenciais inv√°lidas" })
        }
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –ø–µ—á–∞—Ç—å("Erro no login: " + erro)
        –æ—Ç–≤–µ—Ç.status(500)
        –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao processar login: " + erro })
    }
})

# API para obter coment√°rios
servidor.get("/api/comments", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –ø—É—Å—Ç—å comments = obterComentarios()
        –æ—Ç–≤–µ—Ç.json(comments)
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –æ—Ç–≤–µ—Ç.status(500)
        –æ—Ç–≤–µ—Ç.json({ error = "Erro ao carregar coment√°rios" })
    }
})

# API para adicionar coment√°rio
servidor.post("/api/comments", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –ø—É—Å—Ç—å body = –∑–∞–ø—Ä–æ—Å.body
        
        –ø—É—Å—Ç—å novoComment = {
            id = Date.timestamp() + "-" + Crypto.randomBytes(8),
            name = body.name,
            text = body.text,
            date = Date.timestamp()
        }
        
        –ø—É—Å—Ç—å sucesso = adicionarComentario(novoComment.id, novoComment.name, novoComment.text, novoComment.date)
        
        –µ—Å–ª–∏ (sucesso) {
            –æ—Ç–≤–µ—Ç.json({ success = –∏—Å—Ç–∏–Ω–∞, comment = novoComment })
        } –∏–Ω–∞—á–µ {
            –æ—Ç–≤–µ—Ç.status(500)
            –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao adicionar coment√°rio" })
        }
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –æ—Ç–≤–µ—Ç.status(500)
        –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao adicionar coment√°rio: " + erro })
    }
})

# Rota do painel admin (protegida)
servidor.get("/admin", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –µ—Å–ª–∏ (!verificarAuth(–∑–∞–ø—Ä–æ—Å)) {
        –æ—Ç–≤–µ—Ç.status(302)
        –æ—Ç–≤–µ—Ç.header("Location", "/login")
        –æ—Ç–≤–µ—Ç.send("")
    } –∏–Ω–∞—á–µ {
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –ø—É—Å—Ç—å comments = obterComentarios()
        –ø—É—Å—Ç—å whatsappStats = obterEstatisticasCliques()
        –ø—É—Å—Ç—å html = "<!DOCTYPE html>\n" +
"<html lang=\"pt-BR\">\n" +
"<head>\n" +
"    <meta charset=\"UTF-8\">\n" +
"    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n" +
"    <title>Painel Admin</title>\n" +
carregarCSS() + "\n" +
"</head>\n" +
"<body>\n" +
"    <div class=\"container\">\n" +
"        <div class=\"header\">\n" +
"            <h1>üîê Painel Admin</h1>\n" +
"            <div>\n" +
"                <a href=\"/\" class=\"btn\">‚Üê Voltar ao site</a>\n" +
"                <button class=\"btn btn-danger\" onclick=\"logout()\" style=\"margin-left: 0.5rem;\">Sair</button>\n" +
"            </div>\n" +
"        </div>\n" +
"        <div class=\"tabs\">\n" +
"            <button class=\"tab active\" onclick=\"switchTab('comments')\">üí¨ Coment√°rios</button>\n" +
"            <button class=\"tab\" onclick=\"switchTab('whatsapp')\">üì± WhatsApp</button>\n" +
"        </div>\n" +
"        <div id=\"commentsTab\" class=\"tab-content active\">\n" +
"            <div id=\"commentsList\">Carregando coment√°rios...</div>\n" +
"        </div>\n" +
"        <div id=\"whatsappTab\" class=\"tab-content\">\n" +
"            <div class=\"whatsapp-form\" style=\"background: #1a1a2e; border-color: #6366f1;\">\n" +
"                <h3 style=\"margin-bottom: 1rem; color: #6366f1;\">üîÑ Rota√ß√£o Autom√°tica</h3>\n" +
"                <div style=\"display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;\">\n" +
"                    <label style=\"display: flex; align-items: center; gap: 0.5rem; cursor: pointer;\">\n" +
"                        <input type=\"checkbox\" id=\"rotationEnabled\" style=\"width: 20px; height: 20px; cursor: pointer;\">\n" +
"                        <span>Ativar rota√ß√£o autom√°tica</span>\n" +
"                    </label>\n" +
"                </div>\n" +
"                <div style=\"display: flex; gap: 1rem; align-items: center;\">\n" +
"                    <label style=\"flex: 1;\">\n" +
"                        <span style=\"display: block; margin-bottom: 0.5rem; color: #a0a0a0;\">Limite de cliques por n√∫mero:</span>\n" +
"                        <input type=\"number\" id=\"clickLimit\" min=\"0\" value=\"0\" style=\"width: 100%; background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 6px; padding: 0.75rem; color: #e0e0e0; font-family: inherit;\">\n" +
"                    </label>\n" +
"                    <button class=\"btn\" onclick=\"saveRotationConfig()\" style=\"margin-top: 1.5rem;\">Salvar Configura√ß√£o</button>\n" +
"                </div>\n" +
"                <div style=\"margin-top: 1rem; padding: 1rem; background: #0a0a0a; border-radius: 6px; font-size: 0.875rem; color: #a0a0a0;\">\n" +
"                    <strong>Como funciona:</strong> Quando a rota√ß√£o est√° ativa, cada n√∫mero pode receber at√© X cliques. Ao atingir o limite, o sistema automaticamente passa para o pr√≥ximo n√∫mero e zera a contagem do anterior.\n" +
"                </div>\n" +
"            </div>\n" +
"            <div class=\"whatsapp-form\">\n" +
"                <h3 style=\"margin-bottom: 1rem;\">‚ûï Adicionar Novo N√∫mero</h3>\n" +
"                <form id=\"whatsappForm\">\n" +
"                    <input type=\"text\" id=\"whatsappName\" placeholder=\"Nome (ex: Suporte, Vendas)\" required>\n" +
"                    <input type=\"text\" id=\"whatsappNumber\" placeholder=\"N√∫mero (ex: 5511999999999)\" required>\n" +
"                    <button type=\"submit\" class=\"btn\">Adicionar N√∫mero</button>\n" +
"                </form>\n" +
"            </div>\n" +
"            <div id=\"whatsappList\">Carregando n√∫meros...</div>\n" +
"        </div>\n" +
"    </div>\n" +
"    <script>\n" +
"        let comments = " + JSON.stringify(comments) + ";\n" +
"        let whatsappNumbers = " + JSON.stringify(whatsappStats) + ";\n" +
"\n" +
"        function switchTab(tabName) {\n" +
"            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));\n" +
"            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));\n" +
"            event.target.classList.add('active');\n" +
"            document.getElementById(tabName + 'Tab').classList.add('active');\n" +
"            if (tabName === 'whatsapp') {\n" +
"                loadRotationConfig();\n" +
"                renderWhatsApp();\n" +
"            }\n" +
"        }\n" +
"\n" +
"        function renderWhatsApp() {\n" +
"            const div = document.getElementById('whatsappList');\n" +
"            if (whatsappNumbers.length === 0) {\n" +
"                div.innerHTML = '<div class=\"empty\">Nenhum n√∫mero cadastrado ainda.</div>';\n" +
"                return;\n" +
"            }\n" +
"            div.innerHTML = whatsappNumbers.map(num => `\n" +
"                <div class=\"whatsapp-item ${num.active ? 'active' : ''}\">\n" +
"                    <div class=\"whatsapp-header\">\n" +
"                        <div>\n" +
"                            <div class=\"whatsapp-name\">${escapeHtml(num.name)} <span class=\"status-badge ${num.active ? 'status-active' : 'status-inactive'}\">${num.active ? 'ATIVO' : 'INATIVO'}</span></div>\n" +
"                            <div class=\"whatsapp-number\">${escapeHtml(num.number)}</div>\n" +
"                        </div>\n" +
"                        <div class=\"whatsapp-stats\">\n" +
"                            <div class=\"stat-item\">\n" +
"                                <span class=\"stat-label\">Total de Cliques</span>\n" +
"                                <span class=\"stat-value\">${num.total_clicks || 0}</span>\n" +
"                            </div>\n" +
"                            ${num.active && num.click_limit > 0 ? `\n" +
"                            <div class=\"stat-item\">\n" +
"                                <span class=\"stat-label\">Cliques Atuais / Limite</span>\n" +
"                                <span class=\"stat-value\" style=\"color: ${(num.current_clicks || 0) >= num.click_limit ? '#ef4444' : '#6366f1'}\">${num.current_clicks || 0} / ${num.click_limit}</span>\n" +
"                            </div>\n" +
"                            ` : ''}\n" +
"                        </div>\n" +
"                    </div>\n" +
"                    <div class=\"comment-actions\">\n" +
"                        ${!num.active ? `<button class=\"btn\" onclick=\"activateNumber(${num.id})\">Ativar</button>` : ''}\n" +
"                        <button class=\"btn\" onclick=\"editWhatsApp(${num.id})\">Editar</button>\n" +
"                        <button class=\"btn btn-danger\" onclick=\"deleteWhatsApp(${num.id})\">Deletar</button>\n" +
"                    </div>\n" +
"                    <div class=\"edit-form\" id=\"edit-${num.id}\">\n" +
"                        <input type=\"text\" id=\"edit-name-${num.id}\" value=\"${escapeHtml(num.name)}\" placeholder=\"Nome\">\n" +
"                        <input type=\"text\" id=\"edit-number-${num.id}\" value=\"${escapeHtml(num.number)}\" placeholder=\"N√∫mero\">\n" +
"                        <button class=\"btn\" onclick=\"saveEdit(${num.id})\">Salvar</button>\n" +
"                        <button class=\"btn\" onclick=\"cancelEdit(${num.id})\">Cancelar</button>\n" +
"                    </div>\n" +
"                </div>\n" +
"            `).join('');\n" +
"        }\n" +
"\n" +
"        document.getElementById('whatsappForm').addEventListener('submit', function(e) {\n" +
"            e.preventDefault();\n" +
"            const name = document.getElementById('whatsappName').value;\n" +
"            const number = document.getElementById('whatsappNumber').value;\n" +
"            fetch('/api/admin/whatsapp', {\n" +
"                method: 'POST',\n" +
"                headers: { 'Content-Type': 'application/json' },\n" +
"                body: JSON.stringify({ name, number })\n" +
"            })\n" +
"            .then(res => res.json())\n" +
"            .then(data => {\n" +
"                if (data.success) {\n" +
"                    document.getElementById('whatsappForm').reset();\n" +
"                    loadWhatsApp();\n" +
"                } else {\n" +
"                    alert('Erro: ' + (data.error || 'Erro desconhecido'));\n" +
"                }\n" +
"            })\n" +
"            .catch(err => alert('Erro ao adicionar n√∫mero'));\n" +
"        });\n" +
"\n" +
"        function activateNumber(id) {\n" +
"            fetch('/api/admin/whatsapp/' + id + '/activate', { method: 'POST' })\n" +
"            .then(res => res.json())\n" +
"            .then(data => {\n" +
"                if (data.success) loadWhatsApp();\n" +
"                else alert('Erro: ' + (data.error || 'Erro desconhecido'));\n" +
"            })\n" +
"            .catch(err => alert('Erro ao ativar n√∫mero'));\n" +
"        }\n" +
"\n" +
"        function editWhatsApp(id) {\n" +
"            document.getElementById('edit-' + id).style.display = 'block';\n" +
"        }\n" +
"\n" +
"        function cancelEdit(id) {\n" +
"            document.getElementById('edit-' + id).style.display = 'none';\n" +
"        }\n" +
"\n" +
"        function saveEdit(id) {\n" +
"            const name = document.getElementById('edit-name-' + id).value;\n" +
"            const number = document.getElementById('edit-number-' + id).value;\n" +
"            fetch('/api/admin/whatsapp/' + id, {\n" +
"                method: 'PUT',\n" +
"                headers: { 'Content-Type': 'application/json' },\n" +
"                body: JSON.stringify({ name, number })\n" +
"            })\n" +
"            .then(res => res.json())\n" +
"            .then(data => {\n" +
"                if (data.success) {\n" +
"                    document.getElementById('edit-' + id).style.display = 'none';\n" +
"                    loadWhatsApp();\n" +
"                } else {\n" +
"                    alert('Erro: ' + (data.error || 'Erro desconhecido'));\n" +
"                }\n" +
"            })\n" +
"            .catch(err => alert('Erro ao editar n√∫mero'));\n" +
"        }\n" +
"\n" +
"        function deleteWhatsApp(id) {\n" +
"            if (!confirm('Tem certeza que deseja deletar este n√∫mero?')) return;\n" +
"            fetch('/api/admin/whatsapp/' + id, { method: 'DELETE' })\n" +
"            .then(res => res.json())\n" +
"            .then(data => {\n" +
"                if (data.success) loadWhatsApp();\n" +
"                else alert('Erro: ' + (data.error || 'Erro desconhecido'));\n" +
"            })\n" +
"            .catch(err => alert('Erro ao deletar n√∫mero'));\n" +
"        }\n" +
"\n" +
"        function loadRotationConfig() {\n" +
"            fetch('/api/admin/whatsapp/rotation')\n" +
"            .then(res => res.json())\n" +
"            .then(data => {\n" +
"                if (data.success) {\n" +
"                    document.getElementById('rotationEnabled').checked = data.enabled;\n" +
"                    document.getElementById('clickLimit').value = data.limit || 0;\n" +
"                }\n" +
"            })\n" +
"            .catch(err => console.error('Erro ao carregar configura√ß√£o de rota√ß√£o:', err));\n" +
"        }\n" +
"\n" +
"        function saveRotationConfig() {\n" +
"            const enabled = document.getElementById('rotationEnabled').checked;\n" +
"            const limit = parseInt(document.getElementById('clickLimit').value) || 0;\n" +
"            fetch('/api/admin/whatsapp/rotation', {\n" +
"                method: 'POST',\n" +
"                headers: { 'Content-Type': 'application/json' },\n" +
"                body: JSON.stringify({ enabled, limit })\n" +
"            })\n" +
"            .then(res => res.json())\n" +
"            .then(data => {\n" +
"                if (data.success) {\n" +
"                    alert('‚úÖ Configura√ß√£o de rota√ß√£o salva com sucesso!');\n" +
"                    loadWhatsApp();\n" +
"                } else {\n" +
"                    alert('‚ùå Erro: ' + (data.error || 'Erro desconhecido'));\n" +
"                }\n" +
"            })\n" +
"            .catch(err => alert('Erro ao salvar configura√ß√£o'));\n" +
"        }\n" +
"\n" +
"        function loadWhatsApp() {\n" +
"            fetch('/api/admin/whatsapp')\n" +
"            .then(res => res.json())\n" +
"            .then(data => {\n" +
"                if (data.success) {\n" +
"                    whatsappNumbers = data.numbers;\n" +
"                    renderWhatsApp();\n" +
"                }\n" +
"            })\n" +
"            .catch(err => console.error('Erro ao carregar n√∫meros:', err));\n" +
"        }\n" +
"\n" +
"        function renderComments() {\n" +
"            const div = document.getElementById('commentsList');\n" +
"            if (comments.length === 0) {\n" +
"                div.innerHTML = '<div class=\"empty\">Nenhum coment√°rio ainda.</div>';\n" +
"                return;\n" +
"            }\n" +
"            div.innerHTML = comments.map((comment, index) => `\n" +
"                <div class=\"comment-item\" id=\"comment-${comment.id}\">\n" +
"                    <div class=\"comment-header\">\n" +
"                        <span class=\"comment-author\">${escapeHtml(comment.name)}</span>\n" +
"                        <span class=\"comment-date\">${new Date(comment.date).toLocaleString('pt-BR')}</span>\n" +
"                    </div>\n" +
"                    <div class=\"comment-text\" id=\"text-${comment.id}\">${escapeHtml(comment.text)}</div>\n" +
"                    <div class=\"edit-form\" id=\"edit-${comment.id}\">\n" +
"                        <textarea id=\"textarea-${comment.id}\">${escapeHtml(comment.text)}</textarea>\n" +
"                        <button class=\"btn\" onclick=\"saveEdit('${comment.id}')\">Salvar</button>\n" +
"                        <button class=\"btn\" onclick=\"cancelEdit('${comment.id}')\">Cancelar</button>\n" +
"                    </div>\n" +
"                    <div class=\"comment-actions\">\n" +
"                        <button class=\"btn\" onclick=\"editComment('${comment.id}')\">Editar</button>\n" +
"                        <button class=\"btn btn-danger\" onclick=\"deleteComment('${comment.id}')\">Deletar</button>\n" +
"                    </div>\n" +
"                </div>\n" +
"            `).join('');\n" +
"        }\n" +
"        function escapeHtml(text) { const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }\n" +
"        function editComment(id) {\n" +
"            document.getElementById('text-' + id).style.display = 'none';\n" +
"            document.getElementById('edit-' + id).style.display = 'block';\n" +
"        }\n" +
"        function cancelEdit(id) {\n" +
"            document.getElementById('text-' + id).style.display = 'block';\n" +
"            document.getElementById('edit-' + id).style.display = 'none';\n" +
"        }\n" +
"        function saveEdit(id) {\n" +
"            const text = document.getElementById('textarea-' + id).value;\n" +
"            fetch('/api/admin/comments/' + id, {\n" +
"                method: 'POST',\n" +
"                headers: { 'Content-Type': 'application/json' },\n" +
"                body: JSON.stringify({ text: text })\n" +
"            })\n" +
"            .then(res => res.json())\n" +
"            .then(data => {\n" +
"                if (data.success) {\n" +
"                    const comment = comments.find(c => c.id === id);\n" +
"                    if (comment) comment.text = text;\n" +
"                    renderComments();\n" +
"                } else {\n" +
"                    alert('Erro ao editar: ' + (data.error || 'Erro desconhecido'));\n" +
"                }\n" +
"            })\n" +
"            .catch(err => { alert('Erro ao editar coment√°rio'); });\n" +
"        }\n" +
"        function deleteComment(id) {\n" +
"            if (!confirm('Tem certeza que deseja deletar este coment√°rio?')) return;\n" +
"            fetch('/api/admin/comments/' + id, { method: 'DELETE' })\n" +
"            .then(res => res.json())\n" +
"            .then(data => {\n" +
"                if (data.success) {\n" +
"                    comments = comments.filter(c => c.id !== id);\n" +
"                    renderComments();\n" +
"                } else {\n" +
"                    alert('Erro ao deletar: ' + (data.error || 'Erro desconhecido'));\n" +
"                }\n" +
"            })\n" +
"            .catch(err => { alert('Erro ao deletar coment√°rio'); });\n" +
"        }\n" +
"        function logout() {\n" +
"            fetch('/api/logout', { method: 'POST' })\n" +
"            .then(() => { window.location.href = '/login'; });\n" +
"        }\n" +
"        renderComments();\n" +
"    </script>\n" +
"</body>\n" +
"</html>"
        –æ—Ç–≤–µ—Ç.status(200)
        –æ—Ç–≤–µ—Ç.header("Content-Type", "text/html; charset=utf-8")
        –æ—Ç–≤–µ—Ç.send(html)
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –æ—Ç–≤–µ—Ç.status(500)
        –æ—Ç–≤–µ—Ç.send("Erro ao carregar painel admin")
        }
    }
})

# API para editar coment√°rio (admin)
servidor.post("/api/admin/comments/:id", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –µ—Å–ª–∏ (!verificarAuth(–∑–∞–ø—Ä–æ—Å)) {
        –æ—Ç–≤–µ—Ç.status(401)
        –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "N√£o autorizado" })
    } –∏–Ω–∞—á–µ {
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        # Extrair ID dos par√¢metros da rota
        –ø—É—Å—Ç—å id = –∑–∞–ø—Ä–æ—Å.params.id
        –µ—Å–ª–∏ (id == –Ω—É–ª—å) {
            # Fallback: extrair da URL se params n√£o estiver dispon√≠vel
            –ø—É—Å—Ç—å commentId = –∑–∞–ø—Ä–æ—Å.pathname
            –ø—É—Å—Ç—å partes = String.—Ä–∞–∑–¥–µ–ª–∏—Ç—å(commentId, "/")
            id = partes[Array.–¥–ª–∏–Ω–∞(partes) - 1]
        }
        
        –ø—É—Å—Ç—å body = –∑–∞–ø—Ä–æ—Å.body
        
        –ø—É—Å—Ç—å sucesso = atualizarComentario(id, body.text)
        
        –µ—Å–ª–∏ (sucesso) {
            –æ—Ç–≤–µ—Ç.json({ success = –∏—Å—Ç–∏–Ω–∞ })
        } –∏–Ω–∞—á–µ {
            –æ—Ç–≤–µ—Ç.status(404)
            –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Coment√°rio n√£o encontrado" })
        }
        } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
            –æ—Ç–≤–µ—Ç.status(500)
            –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao editar coment√°rio" })
        }
    }
})

# API para deletar coment√°rio (admin)
servidor.delete("/api/admin/comments/:id", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –µ—Å–ª–∏ (!verificarAuth(–∑–∞–ø—Ä–æ—Å)) {
        –æ—Ç–≤–µ—Ç.status(401)
        –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "N√£o autorizado" })
    } –∏–Ω–∞—á–µ {
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
            # Extrair ID dos par√¢metros da rota
            –ø—É—Å—Ç—å id = –∑–∞–ø—Ä–æ—Å.params.id
            –µ—Å–ª–∏ (id == –Ω—É–ª—å) {
                # Fallback: extrair da URL se params n√£o estiver dispon√≠vel
                –ø—É—Å—Ç—å commentId = –∑–∞–ø—Ä–æ—Å.pathname
                –ø—É—Å—Ç—å partes = String.—Ä–∞–∑–¥–µ–ª–∏—Ç—å(commentId, "/")
                id = partes[Array.–¥–ª–∏–Ω–∞(partes) - 1]
            }
            
            –ø—É—Å—Ç—å sucesso = deletarComentario(id)
            
            –µ—Å–ª–∏ (sucesso) {
                –æ—Ç–≤–µ—Ç.json({ success = –∏—Å—Ç–∏–Ω–∞ })
            } –∏–Ω–∞—á–µ {
                –æ—Ç–≤–µ—Ç.status(404)
                –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Coment√°rio n√£o encontrado" })
            }
        } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
            –æ—Ç–≤–µ—Ç.status(500)
            –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao deletar coment√°rio" })
        }
    }
})

# ========== ROTAS API WHATSAPP ==========

# API para obter n√∫mero ativo do WhatsApp
servidor.get("/api/whatsapp/active", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        # Sempre buscar do banco de dados (sem cache)
        –ø—É—Å—Ç—å numeroAtivo = obterNumeroAtivo()
        –µ—Å–ª–∏ (numeroAtivo != –Ω—É–ª—å) {
            # Adicionar headers para evitar cache
            –æ—Ç–≤–µ—Ç.header("Cache-Control", "no-cache, no-store, must-revalidate")
            –æ—Ç–≤–µ—Ç.header("Pragma", "no-cache")
            –æ—Ç–≤–µ—Ç.header("Expires", "0")
            –æ—Ç–≤–µ—Ç.json({ number = numeroAtivo.number, name = numeroAtivo.name })
        } –∏–Ω–∞—á–µ {
            –æ—Ç–≤–µ—Ç.header("Cache-Control", "no-cache, no-store, must-revalidate")
            –æ—Ç–≤–µ—Ç.header("Pragma", "no-cache")
            –æ—Ç–≤–µ—Ç.json({ number = –Ω—É–ª—å, name = –Ω—É–ª—å })
        }
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –æ—Ç–≤–µ—Ç.status(500)
        –æ—Ç–≤–µ—Ç.json({ error = "Erro ao obter n√∫mero ativo" })
    }
})

# API para registrar clique no WhatsApp
servidor.post("/api/whatsapp/click", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
        –ø—É—Å—Ç—å numeroAtivo = obterNumeroAtivo()
        –µ—Å–ª–∏ (numeroAtivo != –Ω—É–ª—å) {
            registrarClique(numeroAtivo.id)
            –æ—Ç–≤–µ—Ç.json({ success = –∏—Å—Ç–∏–Ω–∞ })
        } –∏–Ω–∞—á–µ {
            –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Nenhum n√∫mero ativo" })
        }
    } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
        –æ—Ç–≤–µ—Ç.status(500)
        –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao registrar clique" })
    }
})

# ========== ROTAS API ADMIN WHATSAPP ==========

# API para obter todos os n√∫meros (admin)
servidor.get("/api/admin/whatsapp", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –µ—Å–ª–∏ (!verificarAuth(–∑–∞–ø—Ä–æ—Å)) {
        –æ—Ç–≤–µ—Ç.status(401)
        –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "N√£o autorizado" })
    } –∏–Ω–∞—á–µ {
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
            –ø—É—Å—Ç—å stats = obterEstatisticasCliques()
            –æ—Ç–≤–µ—Ç.json({ success = –∏—Å—Ç–∏–Ω–∞, numbers = stats })
        } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
            –æ—Ç–≤–µ—Ç.status(500)
            –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao obter n√∫meros" })
        }
    }
})

# API para adicionar n√∫mero (admin)
servidor.post("/api/admin/whatsapp", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –µ—Å–ª–∏ (!verificarAuth(–∑–∞–ø—Ä–æ—Å)) {
        –æ—Ç–≤–µ—Ç.status(401)
        –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "N√£o autorizado" })
    } –∏–Ω–∞—á–µ {
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
            –ø—É—Å—Ç—å body = –∑–∞–ø—Ä–æ—Å.body
            –ø—É—Å—Ç—å sucesso = adicionarNumero(body.name, body.number)
            –µ—Å–ª–∏ (sucesso) {
                –æ—Ç–≤–µ—Ç.json({ success = –∏—Å—Ç–∏–Ω–∞ })
            } –∏–Ω–∞—á–µ {
                –æ—Ç–≤–µ—Ç.status(500)
                –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao adicionar n√∫mero" })
            }
        } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
            –æ—Ç–≤–µ—Ç.status(500)
            –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao adicionar n√∫mero: " + erro })
        }
    }
})

# API para atualizar n√∫mero (admin)
servidor.put("/api/admin/whatsapp/:id", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –µ—Å–ª–∏ (!verificarAuth(–∑–∞–ø—Ä–æ—Å)) {
        –æ—Ç–≤–µ—Ç.status(401)
        –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "N√£o autorizado" })
    } –∏–Ω–∞—á–µ {
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
            –ø—É—Å—Ç—å id = –∑–∞–ø—Ä–æ—Å.params.id
            –µ—Å–ª–∏ (id == –Ω—É–ª—å) {
                –ø—É—Å—Ç—å partes = String.—Ä–∞–∑–¥–µ–ª–∏—Ç—å(–∑–∞–ø—Ä–æ—Å.pathname, "/")
                id = partes[Array.–¥–ª–∏–Ω–∞(partes) - 1]
            }
            –ø—É—Å—Ç—å body = –∑–∞–ø—Ä–æ—Å.body
            –ø—É—Å—Ç—å sucesso = atualizarNumero(id, body.name, body.number)
            –µ—Å–ª–∏ (sucesso) {
                –æ—Ç–≤–µ—Ç.json({ success = –∏—Å—Ç–∏–Ω–∞ })
            } –∏–Ω–∞—á–µ {
                –æ—Ç–≤–µ—Ç.status(404)
                –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "N√∫mero n√£o encontrado" })
            }
        } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
            –æ—Ç–≤–µ—Ç.status(500)
            –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao atualizar n√∫mero" })
        }
    }
})

# API para ativar n√∫mero (admin)
servidor.post("/api/admin/whatsapp/:id/activate", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –µ—Å–ª–∏ (!verificarAuth(–∑–∞–ø—Ä–æ—Å)) {
        –æ—Ç–≤–µ—Ç.status(401)
        –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "N√£o autorizado" })
    } –∏–Ω–∞—á–µ {
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
            –ø—É—Å—Ç—å id = –∑–∞–ø—Ä–æ—Å.params.id
            –µ—Å–ª–∏ (id == –Ω—É–ª—å) {
                –ø—É—Å—Ç—å partes = String.—Ä–∞–∑–¥–µ–ª–∏—Ç—å(–∑–∞–ø—Ä–æ—Å.pathname, "/")
                id = partes[Array.–¥–ª–∏–Ω–∞(partes) - 1]
            }
            –ø—É—Å—Ç—å sucesso = ativarNumero(id)
            –µ—Å–ª–∏ (sucesso) {
                –æ—Ç–≤–µ—Ç.json({ success = –∏—Å—Ç–∏–Ω–∞ })
            } –∏–Ω–∞—á–µ {
                –æ—Ç–≤–µ—Ç.status(404)
                –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "N√∫mero n√£o encontrado" })
            }
        } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
            –æ—Ç–≤–µ—Ç.status(500)
            –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao ativar n√∫mero" })
        }
    }
})

# API para deletar n√∫mero (admin)
servidor.delete("/api/admin/whatsapp/:id", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –µ—Å–ª–∏ (!verificarAuth(–∑–∞–ø—Ä–æ—Å)) {
        –æ—Ç–≤–µ—Ç.status(401)
        –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "N√£o autorizado" })
    } –∏–Ω–∞—á–µ {
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
            –ø—É—Å—Ç—å id = –∑–∞–ø—Ä–æ—Å.params.id
            –µ—Å–ª–∏ (id == –Ω—É–ª—å) {
                –ø—É—Å—Ç—å partes = String.—Ä–∞–∑–¥–µ–ª–∏—Ç—å(–∑–∞–ø—Ä–æ—Å.pathname, "/")
                id = partes[Array.–¥–ª–∏–Ω–∞(partes) - 1]
            }
            –ø—É—Å—Ç—å sucesso = deletarNumero(id)
            –µ—Å–ª–∏ (sucesso) {
                –æ—Ç–≤–µ—Ç.json({ success = –∏—Å—Ç–∏–Ω–∞ })
            } –∏–Ω–∞—á–µ {
                –æ—Ç–≤–µ—Ç.status(404)
                –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "N√∫mero n√£o encontrado" })
            }
        } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
            –æ—Ç–≤–µ—Ç.status(500)
            –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao deletar n√∫mero" })
        }
    }
})

# API para obter configura√ß√£o de rota√ß√£o
servidor.get("/api/admin/whatsapp/rotation", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –µ—Å–ª–∏ (!verificarAuth(–∑–∞–ø—Ä–æ—Å)) {
        –æ—Ç–≤–µ—Ç.status(401)
        –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "N√£o autorizado" })
    } –∏–Ω–∞—á–µ {
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
            –ø—É—Å—Ç—å config = obterConfiguracaoRotacao()
            –æ—Ç–≤–µ—Ç.json({ success = –∏—Å—Ç–∏–Ω–∞, enabled = config.enabled, limit = config.limit })
        } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
            –æ—Ç–≤–µ—Ç.status(500)
            –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao obter configura√ß√£o" })
        }
    }
})

# API para definir configura√ß√£o de rota√ß√£o
servidor.post("/api/admin/whatsapp/rotation", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –µ—Å–ª–∏ (!verificarAuth(–∑–∞–ø—Ä–æ—Å)) {
        –æ—Ç–≤–µ—Ç.status(401)
        –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "N√£o autorizado" })
    } –∏–Ω–∞—á–µ {
        –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
            –ø—É—Å—Ç—å body = –∑–∞–ø—Ä–æ—Å.body
            –ø—É—Å—Ç—å ativado = body.enabled == –∏—Å—Ç–∏–Ω–∞
            –ø—É—Å—Ç—å limite = body.limit
            –µ—Å–ª–∏ (limite < 0) {
                limite = 0
            }
            –ø—É—Å—Ç—å sucesso = definirRotacao(ativado, limite)
            –µ—Å–ª–∏ (sucesso) {
                –æ—Ç–≤–µ—Ç.json({ success = –∏—Å—Ç–∏–Ω–∞ })
            } –∏–Ω–∞—á–µ {
                –æ—Ç–≤–µ—Ç.status(500)
                –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao definir rota√ß√£o" })
            }
        } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
            –æ—Ç–≤–µ—Ç.status(500)
            –æ—Ç–≤–µ—Ç.json({ success = –ª–æ–∂—å, error = "Erro ao definir rota√ß√£o: " + erro })
        }
    }
})

# API de logout
servidor.post("/api/logout", —Ñ—É–Ω–∫—Ü–∏—è(–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) {
    –ø—É—Å—Ç—å cookieHeader = –∑–∞–ø—Ä–æ—Å.headers["cookie"]
    –µ—Å–ª–∏ (cookieHeader == –Ω—É–ª—å) {
        cookieHeader = –∑–∞–ø—Ä–æ—Å.headers["Cookie"]
    }
    –ø—É—Å—Ç—å token = extrairCookie(cookieHeader, "auth_token")
    –µ—Å–ª–∏ (token != –Ω—É–ª—å) {
        sessions[token] = –Ω—É–ª—å
    }
    –æ—Ç–≤–µ—Ç.header("Set-Cookie", "auth_token=; Path=/; HttpOnly; Max-Age=0")
    –æ—Ç–≤–µ—Ç.json({ success = –∏—Å—Ç–∏–Ω–∞ })
})

# Iniciar servidor
servidor.listen(3000, —Ñ—É–Ω–∫—Ü–∏—è() {
    –ø–µ—á–∞—Ç—å("üöÄ Site Trest iniciado com sucesso!")
    –ø–µ—á–∞—Ç—å("üåê Acesse: http://localhost:3000")
    –ø–µ—á–∞—Ç—å("üìä Status API: http://localhost:3000/api/status")
})
